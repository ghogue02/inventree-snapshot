import{j as e}from"./vendor-ui-Cn-AWZmU.js";import{a as x,u as T}from"./vendor-react-BHT4GRGd.js";import{s as S,L as Q,C as N,a as P,d as C,b as z}from"./client-DgMJTZRL.js";import{I as y}from"./input-B9kTI4Cn.js";import{B as f}from"./button-DRab5i6-.js";import{S as M,D as q,B as O}from"./badge-BKw_XItu.js";import{b as G,u as V}from"./vendor-utils-CbB7EdWd.js";import{l as _,u as H,d as K}from"./productService-BkrJxGhU.js";import{c as F,u as h,X}from"./index-DKYL_AX4.js";import{S as I}from"./skeleton-ClRWhxbF.js";import{S as $,a as L,b as D,c as E,d as A}from"./select-CmQrNej-.js";import{P as J}from"./plus-BapLzJnN.js";import{C as W}from"./check-CuDtplOH.js";import{T as Y}from"./trash-2-HH2kLMFn.js";import"./chevron-up-Dc_7H3uy.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=F("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=F("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),ae=(o,l)=>{const t="A professional, clean product photo";switch(l.toLowerCase()){case"grains":return`${t} of a box or package of ${o}. Show the packaging clearly with the brand name visible. Style: Commercial product photography on white background.`;case"meat":return`${t} of fresh, raw ${o} on a clean white cutting board. Style: Food photography with soft lighting.`;case"produce":return`${t} of fresh ${o}, well-lit and arranged professionally. Style: Fresh produce photography on white background.`;case"pantry":return`${t} of ${o} in its retail packaging or container. Style: Commercial product photography on white background.`;case"beverages":return`${t} of a single ${o} container or bottle, showing the label clearly. Style: Beverage photography on white background.`;default:return`${t} of ${o} for restaurant inventory. The image should be on a white background, well-lit, and show the product clearly. Category: ${l}. Style: Minimalist commercial product photography.`}},re=async(o,l)=>{try{const t=ae(o,l),{data:c,error:n}=await S.functions.invoke("generate-image",{body:{prompt:t,productName:o,category:l}});if(n)throw new Error(n.message);if(!c?.imageUrl)throw new Error("No image URL returned");const a=await fetch(c.imageUrl);if(!a.ok)throw new Error("Failed to fetch generated image");const u=await a.blob(),g=new FileReader,p=new Promise(m=>{g.onloadend=()=>m(g.result)});return g.readAsDataURL(u),await p}catch{return h.error("Failed to generate image"),null}},se=async o=>{try{const l=o.filter(n=>!n.image);if(l.length===0){h.success("All products already have images");return}h.loading(`Generating images for ${l.length} products...`);let t=0,c=0;for(const n of l)try{const a=await re(n.name,n.category);if(a){const{error:u}=await S.from("products").update({image:a}).eq("id",n.id);u?c++:t++}else c++}catch{c++}c===0?h.success(`Successfully generated ${t} product images`):h.warning(`Generated ${t} images, failed to generate ${c} images`)}catch{h.error("Failed to generate product images")}},be=()=>{const[o,l]=x.useState(""),[t,c]=x.useState(!1),[n,a]=x.useState(!1),[u,g]=x.useState(!1),p=T(),d=G(),{data:m=[],isLoading:v}=V({queryKey:["products"],queryFn:async()=>{const{data:s,error:i}=await S.from("products").select("*").order("category",{ascending:!0});if(i)throw i;return g(s&&s.length>0),s||[]}}),r=m.filter(s=>!s.image),j=m.length>0&&r.length===0,w=async()=>{c(!0);try{await _(),d.invalidateQueries(["products"])}catch(s){console.error("Error loading mock data:",s)}finally{c(!1)}},R=async()=>{a(!0);try{await se(m),d.invalidateQueries(["products"])}catch(s){console.error("Error generating images:",s)}finally{a(!1)}},k=m.filter(s=>s.name.toLowerCase().includes(o.toLowerCase())||s.category.toLowerCase().includes(o.toLowerCase())),U=k.reduce((s,i)=>(s[i.category]||(s[i.category]=[]),s[i.category].push(i),s),{});return e.jsx(Q,{title:"Inventory",description:"Manage and track your restaurant inventory",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"relative w-full sm:w-96",children:[e.jsx(M,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(y,{placeholder:"Search products...",value:o,onChange:s=>l(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{onClick:R,disabled:n||m.length===0||j,variant:j?"secondary":"default",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),j?"All Images Generated":r.length>0?`Generate ${r.length} Images`:"Generate Images"]}),e.jsxs(f,{onClick:w,disabled:t||u,variant:u?"secondary":"default",children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),u?"Sample Data Loaded":"Load Sample Data"]}),e.jsxs(f,{onClick:()=>p("/add-product"),children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Add Product"]})]})]}),v?e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((s,i)=>e.jsxs(N,{children:[e.jsx(P,{children:e.jsx(I,{className:"h-5 w-40"})}),e.jsx(C,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(3)].map((b,B)=>e.jsx(I,{className:"h-24 w-full"},B))})})]},i))}):k.length===0?e.jsx(N,{children:e.jsx(C,{className:"p-6 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No products found"})})}):e.jsx("div",{className:"space-y-6",children:Object.entries(U).map(([s,i])=>e.jsxs(N,{children:[e.jsx(P,{className:"py-4",children:e.jsx(z,{className:"text-md font-medium",children:s})}),e.jsx(C,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(b=>e.jsx(ne,{product:b},b.id))})})]},s))})]})})},te=["Grains","Dairy","Vegetables","Fruits","Meat","Seafood","Spices","Beverages","Snacks","Baked Goods","Canned Goods","Other"],oe=["oz","lb","g","kg","ml","l","each","box","bag","bottle","can","jar","package"],ne=({product:o})=>{const[l,t]=x.useState(!1),[c,n]=x.useState(!1),[a,u]=x.useState(o),g=G(),p=a.currentStock<=a.reorderPoint,d=(r,j)=>{u(w=>({...w,[r]:j}))},m=async()=>{n(!0);try{await H(a),g.invalidateQueries(["products"]),t(!1)}catch(r){console.error("Error updating product:",r)}finally{n(!1)}},v=async()=>{if(confirm("Are you sure you want to delete this product?")){n(!0);try{await K(a.id),g.invalidateQueries(["products"]),h.success("Product deleted successfully")}catch(r){console.error("Error deleting product:",r),h.error("Failed to delete product")}finally{n(!1)}}};return l?e.jsxs("div",{className:"inventory-card border rounded-lg p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center ${p?"bg-orange-100 text-orange-500":"bg-blue-100 text-blue-500"}`,children:a.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>t(!1),disabled:c,children:e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(f,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:m,disabled:c,children:e.jsx(W,{className:"h-4 w-4 text-green-500"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(y,{value:a.name,onChange:r=>d("name",r.target.value),placeholder:"Product name",className:"mb-2"}),e.jsxs($,{value:a.category,onValueChange:r=>d("category",r),children:[e.jsx(L,{className:"w-full",children:e.jsx(D,{placeholder:"Select category"})}),e.jsx(E,{children:te.map(r=>e.jsx(A,{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx(y,{type:"number",value:a.currentStock,onChange:r=>d("currentStock",parseInt(r.target.value)||0),placeholder:"Current stock"})}),e.jsx("div",{children:e.jsxs($,{value:a.unit,onValueChange:r=>d("unit",r),children:[e.jsx(L,{children:e.jsx(D,{placeholder:"Select unit"})}),e.jsx(E,{children:oe.map(r=>e.jsx(A,{value:r,children:r},r))})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx(y,{type:"number",value:a.reorderPoint,onChange:r=>d("reorderPoint",parseInt(r.target.value)||0),placeholder:"Reorder point"})}),e.jsx("div",{children:e.jsx(y,{type:"number",step:"0.01",value:a.cost,onChange:r=>d("cost",parseFloat(r.target.value)||0),placeholder:"Cost per unit"})})]})]})]}):e.jsxs("div",{className:"inventory-card border rounded-lg p-4 bg-white shadow-sm relative",children:[e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>t(!0),children:e.jsx(ee,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(f,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:v,children:e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[a.image?e.jsx("img",{src:a.image,alt:a.name,className:"h-10 w-10 rounded-full object-cover"}):e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center ${p?"bg-orange-100 text-orange-500":"bg-blue-100 text-blue-500"}`,children:a.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm",children:a.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.category," â€¢ ",a.unit]})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Current Stock"}),e.jsxs("p",{className:"font-medium",children:[a.currentStock," ",a.unit,p&&e.jsx(O,{variant:"outline",className:"ml-2 bg-orange-50 text-orange-500 border-orange-200",children:"Low"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Value"}),e.jsxs("p",{className:"font-medium",children:["$",(a.currentStock*a.cost).toFixed(2)]})]})]}),e.jsxs("div",{className:"mt-3 text-xs",children:[e.jsx("div",{className:"h-1.5 w-full bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${a.currentStock<a.reorderPoint?"bg-orange-500":a.currentStock<a.reorderPoint*2?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(100,a.currentStock/(a.reorderPoint*3)*100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Reorder at: ",a.reorderPoint]}),e.jsxs("span",{className:"font-medium",children:["$",a.cost,"/",a.unit]})]})]})]})};export{be as default};
//# sourceMappingURL=Inventory-CTIF29lO.js.map
