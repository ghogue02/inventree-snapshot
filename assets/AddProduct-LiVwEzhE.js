import{j as e}from"./vendor-ui-Cn-AWZmU.js";import{u as _,a as o}from"./vendor-react-BHT4GRGd.js";import{C as j,d as y,L as $,e as w}from"./client-DgMJTZRL.js";import{T as H,b as J,c as P,d as k,e as K}from"./tabs-BKfKmjqt.js";import{u as i}from"./index-DKYL_AX4.js";import{B as R}from"./button-DRab5i6-.js";import{I as g}from"./input-B9kTI4Cn.js";import{L as d}from"./label-CvkvSmM1.js";import{S as L,a as U,b as T,c as V,d as D}from"./select-CmQrNej-.js";import{a as Q}from"./productService-BkrJxGhU.js";import{L as N,U as X}from"./upload-CsKrtzVR.js";import"./vendor-utils-CbB7EdWd.js";import"./chevron-up-Dc_7H3uy.js";import"./check-CuDtplOH.js";const Y=["Grains","Dairy","Vegetables","Fruits","Meat","Seafood","Spices","Beverages","Snacks","Baked Goods","Canned Goods","Other"],Z=["oz","lb","g","kg","ml","l","each","box","bag","bottle","can","jar","package"],z=({initialValues:C,rawAnalysis:f})=>{const n=_(),[u,p]=o.useState(!1),[s,h]=o.useState({name:"",category:"Other",unit:"each",cost:0,currentStock:1,reorderPoint:5,size:"",...C}),c=(a,r)=>{h(b=>({...b,[a]:r}))},v=async a=>{a.preventDefault(),p(!0);try{if(!s.name||!s.category||!s.unit){i.error("Please fill in all required fields");return}const r=await Q({name:s.name,category:s.category,unit:s.unit,cost:typeof s.cost=="number"?s.cost:0,currentStock:typeof s.currentStock=="number"?s.currentStock:0,reorderPoint:typeof s.reorderPoint=="number"?s.reorderPoint:5,size:s.size,image:s.image});i.success("Product added successfully!"),n("/inventory")}catch(r){console.error("Error adding product:",r),i.error("Failed to add product")}finally{p(!1)}};return e.jsx("form",{onSubmit:v,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"name",children:"Product Name *"}),e.jsx(g,{id:"name",value:s.name,onChange:a=>c("name",a.target.value),placeholder:"Product name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"category",children:"Category *"}),e.jsxs(L,{value:s.category,onValueChange:a=>c("category",a),children:[e.jsx(U,{children:e.jsx(T,{placeholder:"Select category"})}),e.jsx(V,{children:Y.map(a=>e.jsx(D,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"size",children:"Size/Volume"}),e.jsx(g,{id:"size",value:s.size,onChange:a=>c("size",a.target.value),placeholder:"e.g., 16 oz, 1 liter, 2 lb"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"unit",children:"Unit *"}),e.jsxs(L,{value:s.unit,onValueChange:a=>c("unit",a),children:[e.jsx(U,{children:e.jsx(T,{placeholder:"Select unit"})}),e.jsx(V,{children:Z.map(a=>e.jsx(D,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"cost",children:"Cost ($)"}),e.jsx(g,{id:"cost",type:"number",step:"0.01",value:s.cost,onChange:a=>c("cost",parseFloat(a.target.value)||0),placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"currentStock",children:"Current Stock"}),e.jsx(g,{id:"currentStock",type:"number",step:"1",value:s.currentStock,onChange:a=>c("currentStock",parseInt(a.target.value)||0),placeholder:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"reorderPoint",children:"Reorder Point"}),e.jsx(g,{id:"reorderPoint",type:"number",step:"1",value:s.reorderPoint,onChange:a=>c("reorderPoint",parseInt(a.target.value)||0),placeholder:"0"})]})]}),f&&e.jsx(j,{className:"mt-4",children:e.jsxs(y,{className:"p-4",children:[e.jsx(d,{className:"block mb-2 font-medium",children:"AI Analysis"}),e.jsx("div",{className:"text-sm text-muted-foreground whitespace-pre-wrap bg-gray-50 p-3 rounded-md border",children:f})]})}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>n("/inventory"),children:"Cancel"}),e.jsx(R,{type:"submit",disabled:u,children:u?"Saving...":"Add Product"})]})]})})},he=()=>{const[C,f]=o.useState("form"),[n,u]=o.useState(null),[p,s]=o.useState(!1),[h,c]=o.useState(!1),[v,a]=o.useState(null),[r,b]=o.useState(null),[m,E]=o.useState(null),[A,G]=o.useState(null),F=async()=>{try{const t={video:{facingMode:"environment"},audio:!1},l=await navigator.mediaDevices.getUserMedia(t);m&&(m.srcObject=l,a(l),s(!0))}catch(t){console.error("Error starting camera:",t),i.error("Failed to access camera")}},M=()=>{v&&(v.getTracks().forEach(t=>t.stop()),a(null),s(!1))},O=()=>{if(!m||!A)return;const t=m,l=A,x=l.getContext("2d");if(!x)return;l.width=t.videoWidth,l.height=t.videoHeight,x.drawImage(t,0,0,l.width,l.height);const S=l.toDataURL("image/jpeg");u(S),M()},B=()=>{u(null),b(null),F()},I=async()=>{if(n){c(!0);try{i.loading("Analyzing product...");const t=await K(n);b(t),i.dismiss(),i.success("Analysis complete")}catch(t){console.error("Error analyzing image:",t),i.dismiss(),i.error("Failed to analyze product. Please try again.")}finally{c(!1)}}},q=t=>{const l=t.target.files?.[0];if(!l)return;const x=new FileReader;x.onload=S=>{const W=S.target?.result;u(W)},x.readAsDataURL(l)};return e.jsx($,{title:"Add Product",description:"Add a new product to your inventory",children:e.jsx("div",{className:"p-6",children:e.jsxs(H,{defaultValue:"form",value:C,onValueChange:f,children:[e.jsxs(J,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsx(P,{value:"form",children:"Manual Entry"}),e.jsx(P,{value:"camera",children:"Camera Scan"}),e.jsx(P,{value:"upload",children:"Upload Image"})]}),e.jsx(k,{value:"form",children:e.jsx(j,{children:e.jsx(y,{className:"p-6",children:e.jsx(z,{})})})}),e.jsxs(k,{value:"camera",children:[e.jsx(j,{children:e.jsxs(y,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"video-container bg-gray-100 rounded-md aspect-video relative",children:[n?e.jsx("img",{src:n,alt:"Captured product",className:"w-full h-full object-contain"}):e.jsx("video",{ref:t=>E(t),autoPlay:!0,playsInline:!0,className:`w-full h-full object-cover ${p?"opacity-100":"opacity-0"}`,onLoadedMetadata:()=>{m&&(m.classList.remove("opacity-0"),m.classList.add("opacity-100"))}}),e.jsx("canvas",{ref:t=>G(t),className:"hidden"})]}),e.jsxs("div",{className:"flex justify-center gap-2",children:[!p&&!n&&e.jsxs("button",{onClick:F,className:"bg-blue-500 text-white px-4 py-2 rounded-md flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"Start Camera"]}),p&&!n&&e.jsxs("button",{onClick:O,className:"bg-blue-500 text-white px-4 py-2 rounded-md flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"Capture Image"]}),n&&!h&&!r&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:I,className:"bg-blue-500 text-white px-4 py-2 rounded-md flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),"Analyze Product"]}),e.jsxs("button",{onClick:B,className:"border border-gray-300 px-4 py-2 rounded-md flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"Retake"]})]}),h&&e.jsxs("button",{disabled:!0,className:"bg-blue-500 text-white px-4 py-2 rounded-md flex items-center gap-2 opacity-70",children:[e.jsx(N,{className:"h-4 w-4 animate-spin"}),"Analyzing..."]})]})]})}),r&&e.jsx(j,{className:"mt-6",children:e.jsx(y,{className:"p-6",children:e.jsx(z,{initialValues:r.product,rawAnalysis:r.rawAnalysis})})})]}),e.jsx(k,{value:"upload",children:e.jsx(j,{children:e.jsxs(y,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:q,className:"hidden",id:"product-upload"}),e.jsxs("label",{htmlFor:"product-upload",className:"cursor-pointer flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"p-4 rounded-full bg-gray-100",children:e.jsx(X,{className:"h-8 w-8 text-gray-500"})}),e.jsx("span",{className:"text-sm font-medium",children:"Click to upload image"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"JPG, PNG or GIF up to 10MB"})]}),n&&e.jsxs("div",{className:"mt-4",children:[e.jsx("img",{src:n,alt:"Uploaded product",className:"max-h-[200px] mx-auto object-contain"}),e.jsx("div",{className:"flex justify-center gap-2 mt-4",children:!r&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:I,className:"bg-blue-500 text-white px-4 py-2 rounded-md flex items-center gap-2",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-4 w-4 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-4 w-4"}),"Analyze Product"]})}),e.jsx("button",{onClick:()=>u(null),className:"border border-gray-300 px-4 py-2 rounded-md",children:"Cancel"})]})})]})]}),r&&e.jsx(z,{initialValues:r.product,rawAnalysis:r.rawAnalysis})]})})})]})})})};export{he as default};
//# sourceMappingURL=AddProduct-LiVwEzhE.js.map
