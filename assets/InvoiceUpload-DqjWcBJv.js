import{j as e,h as R}from"./vendor-ui-Cn-AWZmU.js";import{a as o,u as L}from"./vendor-react-BHT4GRGd.js";import{L as E,C as O,d as z,F as w,e as A}from"./client-DgMJTZRL.js";import{B as x}from"./button-DRab5i6-.js";import{I as j}from"./input-B9kTI4Cn.js";import{L as g}from"./label-CvkvSmM1.js";import{g as q}from"./productService-BkrJxGhU.js";import{p as $,a as M}from"./invoiceService-CNowNvjy.js";import{a as B,u as p}from"./index-DKYL_AX4.js";import{u as V,f as K}from"./vendor-utils-CbB7EdWd.js";import{U as Q,L as y}from"./upload-CsKrtzVR.js";import{C as _}from"./check-CuDtplOH.js";import"./utils-B-GjzKLI.js";var G="Separator",I="horizontal",H=["horizontal","vertical"],b=o.forwardRef((i,t)=>{const{decorative:c,orientation:n=I,...l}=i,d=J(n)?n:I,v=c?{role:"none"}:{"aria-orientation":d==="vertical"?d:void 0,role:"separator"};return e.jsx(R.div,{"data-orientation":d,...v,...l,ref:t})});b.displayName=G;function J(i){return H.includes(i)}var C=b;const F=o.forwardRef(({className:i,orientation:t="horizontal",decorative:c=!0,...n},l)=>e.jsx(C,{ref:l,decorative:c,orientation:t,className:B("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",i),...n}));F.displayName=C.displayName;const ce=()=>{const i=L(),t=o.useRef(null),[c,n]=o.useState(null),[l,d]=o.useState(null),[h,v]=o.useState(!1),[a,m]=o.useState(null),{data:P=[]}=V({queryKey:["products"],queryFn:q}),S=s=>{if(s.preventDefault(),s.dataTransfer.files&&s.dataTransfer.files[0]){const r=s.dataTransfer.files[0];N(r)}},N=s=>{if(!s.type.match("image.*")){p.error("Please select an image file");return}n(s);const r=new FileReader;r.onload=()=>{d(r.result)},r.readAsDataURL(s)},D=()=>{t.current&&t.current.click()},U=async()=>{if(!c){p.error("Please select an image first");return}v(!0);try{const s=await $(c);m(s)}catch(s){console.error("Error processing invoice:",s),p.error("Failed to process invoice")}finally{v(!1)}},k=async()=>{if(!a){p.error("No invoice data to save");return}try{const s=a.items.map(u=>{const f=P.find(T=>T.name.toLowerCase()===u.name.toLowerCase());return{id:"",invoiceId:"",productId:f?.id||"",product:f,quantity:u.quantity,unitPrice:u.unitPrice,total:u.total}}),r={supplierName:a.supplierName||"Unknown Supplier",invoiceNumber:a.invoiceNumber||`INV-${Date.now()}`,date:a.date?new Date(a.date):new Date,total:a.total||s.reduce((u,f)=>u+f.total,0),paidStatus:"paid",items:s,imageUrl:l||void 0};await M(r),p.success("Invoice saved successfully"),i("/invoices")}catch(s){console.error("Error saving invoice:",s),p.error("Failed to save invoice")}};return e.jsx(E,{title:"Upload Invoice",description:"Upload and process supplier invoices",children:e.jsx("div",{className:"p-6",children:e.jsx(O,{children:e.jsx(z,{className:"p-6",children:l?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx("div",{className:"bg-gray-100 rounded-lg overflow-hidden",children:e.jsx("img",{src:l,alt:"Invoice preview",className:"w-full h-auto object-contain"})}),e.jsxs("div",{className:"flex justify-between mt-3",children:[e.jsx(x,{variant:"outline",onClick:()=>{d(null),n(null),m(null)},children:"Change Image"}),!a&&e.jsx(x,{onClick:U,disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),"Process Invoice"]})})]})]}),e.jsx("div",{className:"w-full md:w-1/2",children:a?e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Invoice Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"supplier",children:"Supplier"}),e.jsx(j,{id:"supplier",value:a.supplierName||"",onChange:s=>{m({...a,supplierName:s.target.value})}})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"invoice-number",children:"Invoice Number"}),e.jsx(j,{id:"invoice-number",value:a.invoiceNumber||"",onChange:s=>{m({...a,invoiceNumber:s.target.value})}})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"date",children:"Date"}),e.jsx(j,{id:"date",type:"date",value:a.date||K(new Date,"yyyy-MM-dd"),onChange:s=>{m({...a,date:s.target.value})}})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"total",children:"Total"}),e.jsx(j,{id:"total",type:"number",value:a.total||"",onChange:s=>{m({...a,total:parseFloat(s.target.value)})}})]})]}),e.jsx(F,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Items"}),a.items.map((s,r)=>e.jsxs("div",{className:"flex justify-between items-center mb-2 py-2 border-b",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.quantity," x $",s.unitPrice.toFixed(2)]})]}),e.jsxs("p",{className:"font-medium",children:["$",s.total.toFixed(2)]})]},r)),e.jsxs("div",{className:"flex justify-between font-medium mt-4",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",(a.total||a.items.reduce((s,r)=>s+r.total,0)).toFixed(2)]})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs(x,{onClick:k,className:"w-full",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"Save Invoice"]})})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center h-full text-center p-6",children:h?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("div",{className:"absolute -inset-1.5 animate-pulse-light rounded-full bg-restaurant/20"}),e.jsx(y,{className:"h-10 w-10 animate-spin text-restaurant"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Analyzing Invoice..."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Extracting supplier information, items, and prices"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"font-medium",children:'Click "Process Invoice" to analyze the image'}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Our AI will extract items, quantities, and prices automatically"})]})})})]})}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-10 text-center",onDragOver:s=>s.preventDefault(),onDrop:S,children:[e.jsx("input",{type:"file",accept:"image/*",onChange:s=>{s.target.files&&s.target.files[0]&&N(s.target.files[0])},className:"hidden",ref:t}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"p-4 rounded-full bg-gray-100",children:e.jsx(w,{className:"h-10 w-10 text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"Upload Invoice Image"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 mb-4",children:"Drag and drop an image file or click to browse"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(x,{onClick:D,variant:"default",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Select File"]}),e.jsx(x,{variant:"outline",asChild:!0,children:e.jsxs("label",{htmlFor:"camera",className:"cursor-pointer",children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Take Photo",e.jsx("input",{type:"file",id:"camera",accept:"image/*",capture:"environment",className:"hidden",onChange:s=>{s.target.files&&s.target.files[0]&&N(s.target.files[0])}})]})})]})]})]})})})})})};export{ce as default};
//# sourceMappingURL=InvoiceUpload-DqjWcBJv.js.map
